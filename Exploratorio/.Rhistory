sum(is.na(metros_agrupados))
View(metros_agrupados)
df[df$HY_provincia == "Soria" & df$HY_tipo == "Suelo rústico no urbanizable", ]
df[df$HY_provincia == "Soria" & df$HY_tipo == "Suelo rústico no urbanizable", 'HY_metros_totales']
df[df$HY_tipo == "Suelo rústico no urbanizable", 'HY_metros_totales']
df %>% filter(HY_provincia == "Soria") %>%summarise(media = mean(TARGET))
fill_metros <- function(df = df1, grouped = metros_agrupados) {
new <- df
for(i in 1:nrow(new)) {
if(is.na(new[i, 'HY_metros_totales'])) {
if(!is.na(grouped[which(grouped$HY_provincia == new$HY_provincia[i] & grouped$HY_tipo == new$HY_tipo[i]), 'mediana'])){
valor <- grouped[which(grouped$HY_provincia == new$HY_provincia[i] & grouped$HY_tipo == new$HY_tipo[i]), 'mediana']
new[i, 'HY_metros_totales'] <- valor
} else {
newgr <- df %>%
group_by(HY_tipo) %>%
summarise(mediana = median(HY_metros_totales, na.rm=T))
valor <- newgr[which(newgr$HY_provincia == new$HY_provincia[i]), 'mediana']
new[i, 'HY_metros_totales'] <- valor
}
} else {
next
}
}
return(new)
}
df1 <- fill_metros()
fill_metros <- function(df = df1, grouped = metros_agrupados) {
new <- df
for(i in 1:nrow(new)) {
if(is.na(new[i, 'HY_metros_totales'])) {
if(!is.na(grouped[which(grouped$HY_provincia == new$HY_provincia[i] & grouped$HY_tipo == new$HY_tipo[i]), 'mediana'])){
valor <- grouped[which(grouped$HY_provincia == new$HY_provincia[i] & grouped$HY_tipo == new$HY_tipo[i]), 'mediana']
new[i, 'HY_metros_totales'] <- valor
} else {
newgr <- data.frame(df %>%
group_by(HY_tipo) %>%
summarise(mediana = median(HY_metros_totales, na.rm=T)) )
valor <- newgr[which(newgr$HY_provincia == new$HY_provincia[i]), 'mediana']
new[i, 'HY_metros_totales'] <- valor
}
} else {
next
}
}
return(new)
}
df1 <- fill_metros()
fill_metros <- function(df = df1, grouped = metros_agrupados) {
new <- df
for(i in 1:nrow(new)) {
if(is.na(new[i, 'HY_metros_totales'])) {
if(!is.na(grouped[which(grouped$HY_provincia == new$HY_provincia[i] & grouped$HY_tipo == new$HY_tipo[i]), 'mediana'])){
valor <- grouped[which(grouped$HY_provincia == new$HY_provincia[i] & grouped$HY_tipo == new$HY_tipo[i]), 'mediana']
new[i, 'HY_metros_totales'] <- valor
} else {
newgr <- data.frame(new %>%
group_by(HY_tipo) %>%
summarise(mediana = median(HY_metros_totales, na.rm=T)) )
valor <- newgr[which(newgr$HY_provincia == new$HY_provincia[i]), 'mediana']
new[i, 'HY_metros_totales'] <- valor
}
} else {
next
}
}
return(new)
}
df1 <- fill_metros()
df1 <- fill_metros()
fill_metros <- function(df = df1, grouped = metros_agrupados) {
new <- df
for(i in 1:nrow(new)) {
if(is.na(new[i, 'HY_metros_totales'])) {
if(!is.na(grouped[which(grouped$HY_provincia == new$HY_provincia[i] & grouped$HY_tipo == new$HY_tipo[i]), 'mediana'])){
valor <- grouped[which(grouped$HY_provincia == new$HY_provincia[i] & grouped$HY_tipo == new$HY_tipo[i]), 'mediana']
new[i, 'HY_metros_totales'] <- valor
} else {
newgr <- data.frame(new %>%
group_by(HY_tipo) %>%
summarise(mediana = median(HY_metros_totales, na.rm=T)) )
valor <- newgr[which(newgr$HY_tipo == new$HY_tipo[i]), 'mediana']
new[i, 'HY_metros_totales'] <- valor
}
} else {
next
}
}
return(new)
}
df1 <- fill_metros()
sum(is.na(df1$HY_metros_totales))
df1$HY_metros_totales <- log1p(df1$HY_metros_totales)
df1 %>%
ggplot(aes(x = log1p(HY_metros_utiles))) +
geom_histogram(bins = 100)
df1 %>%
ggplot(aes(x = log1p(HY_metros_utiles), y = HY_metros_totales)) +
geom_point()
df1$HY_metros_utiles <- NA
df1 %>%
ggplot(aes(x = HY_num_banos)) +
geom_histogram(bins = 100)
boxplot(df1$HY_num_banos)
df1[df1$HY_num_banos == max(df1$HY_num_banos), c("HY_precio", "TARGET")]
summary(df1$HY_num_banos)
df1[df1$HY_num_banos == max(df1$HY_num_banos), c("HY_precio", "TARGET", "HY_tipo")]
df1[df1$HY_num_banos == max(df1$HY_num_banos), c("HY_num_banos", "HY_precio", "TARGET", "HY_tipo")]
df1[df1$HY_num_banos == max(df1$HY_num_banos), c("HY_num_banos", "HY_precio", "TARGET", "HY_tipo", "IDEA_area")]
df1 %>%
group_by(HY_tipo) %>%
summarise(banos = median(HY_num_banos))
df1[df1$HY_num_banos == 99 & df1$HY_tipo == "Piso"] <- 1
df1[df1$HY_num_banos == 99 & df1$HY_tipo == "Piso", "HY_num_banos"] <- 1
summary(df1$HY_num_banos)
hist(log1p(df1$HY_num_banos))
df1$HY_num_banos <- log1p(df1$HY_num_banos)
df1 %>%
ggplot(aes(x = log1p(HY_precio), y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = F)
df1 %>%
ggplot(aes(x = log1p(HY_precio) / HY_metros_totales, y = log1p(TARGET))) +
geom_point() +
geom_smooth(method = "lm", se = F)
cor((log1p(df1$HY_precio)/df1$HY_metros_totales), log1p(df1$TARGET))
cor((log1p(df1$HY_precio)/df1$HY_metros_totales), log1p(df1$TARGET), na.rm = T)
cor((log1p(df[complete.cases(df1), ]$HY_precio)/df1[complete.cases(df1),]$HY_metros_totales), log1p(df1[complete.cases(df1),]$TARGET), na.rm = T)
cor((log1p(df[complete.cases(df1), ]$HY_precio)/df1[complete.cases(df1),]$HY_metros_totales), log1p(df1[complete.cases(df1),]$TARGET))
df1 %>%
ggplot(aes(x = HY_precio, y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = F)
df1 %>%
ggplot(aes(x = log1p(HY_precio), y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = F)
sum(is.na(df1$HY_precio))
sum(is.na(df1$HY_precio_anterior))
df1$bajado_precio <- ifelse(df1$HY_precio < df1$HY_precio_anterior, 1, 0)
df1 %>%
group_by(bajado_precio) %>%
ggplot(aes(x = bajado_precio, y = TARGET)) +
geom_point()
df1$bajado_precio[is.na(df1$bajado_precio)] <- 0
df1 %>%
group_by(bajado_precio) %>%
ggplot(aes(x = bajado_precio, y = TARGET)) +
geom_point()
df1 %>%
group_by(bajado_precio) %>%
ggplot(aes(x = bajado_precio, y = TARGET)) +
geom_point() +
geom_jitter()
df1 %>%
group_by(bajado_precio) %>%
summarise(target = mean(TARGET)) %>%
ggplot(aes(x = bajado_precio, y = target)) +
geom_bar(stat = "identity") +
coord_flip()
summary(as.factor(df1$HY_cert_energ))
df1 %>%
group_by(HY_cert_energ) %>%
summarise(media_target = mean(TARGET)) %>%
ggplot(aes(x = HY_cert_energ, y = media_target)) +
geom_point()
boxplot(df1$HY_num_terrazas)
hist(df1$HY_num_terrazas)
cor(df1$HY_num_terrazas, df1$TARGET)
plot(df1$HY_num_terrazas, df1$TARGET)
df1$tiene_terraza <- ifelse(df1$HY_num_terrazas > 0, 1, 0)
df1 %>%
group_by(tiene_terraza) %>%
summarise(target = mean(TARGET)) %>%
ggplot(aes(x = tiene_terraza, y = target)) +
geom_point()
df1 %>%
group_by(tiene_terraza) %>%
ggplot(aes(x = tiene_terraza, y = TARGET)) +
geom_point()
df1 %>%
group_by(tiene_terraza) %>%
summarise(target = median(TARGET)) %>%
ggplot(aes(x = tiene_terraza, y = target)) +
geom_point()
summary(df1$HY_ascensor)
df1$HY_ascensor[1:10]
sum(is.na(df1$HY_ascensor))
df1 %>%
group_by(HY_ascensor) %>%
summarise(target = mean(TARGET)) %>%
ggplot(aes(x = HY_ascensor, y = target)) +
geom_point()
df1 %>%
group_by(HY_ascensor) %>%
summarise(target = median(TARGET)) %>%
ggplot(aes(x = HY_ascensor, y = target)) +
geom_point()
df1 %>%
group_by(HY_ascensor) %>%
summarise(target = mean(TARGET)) %>%
ggplot(aes(x = HY_ascensor, y = target)) +
geom_point()
df1 %>%
group_by(HY_ascensor) %>%
filter(HY_tipo == "Piso") %>%
summarise(target = mean(TARGET)) %>%
ggplot(aes(x = HY_ascensor, y = target)) +
geom_point()
df1 %>%
group_by(HY_ascensor) %>%
filter(HY_tipo == "Piso") %>%
summarise(target = median(TARGET)) %>%
ggplot(aes(x = HY_ascensor, y = target)) +
geom_point()
summary(df1$HY_trastero) #otra variable binaria.
df1%>%
group_by(HY_trastero) %>%
summarise(target = mean(TARGET)) %>%
ggplot(aes(x = HY_trastero, y = target)) +
geom_point()
sum(is.na(df1$HY_trastero))
df1 %>%
group_by(HY_trastero) %>%
ggplot(aes(x = HY_trastero, y = TARGET)) +
geom_point()
df1 %>%
group_by(HY_trastero) %>%
ggplot(aes(x = HY_trastero, y = TARGET)) +
geom_point() +
geom_jitter()
summary(df1$HY_num_garajes)
df1 %>%
group_by(HY_num_garajes) %>%
summarise(target = mean(TARGET)) %>%
ggplot(aes(x = HY_num_garajes, y = target)) +
geom_point()
df1 %>%
group_by(HY_num_garajes) %>%
ggplot(aes(x = HY_num_garajes, y = TARGET)) +
geom_point()
df1 %>%
group_by(HY_num_garajes) %>%
ggplot(aes(x = HY_num_garajes, y = TARGET)) +
geom_point() + geom_jitter()
df1$tiene_garaje <- ifelse(df1$HY_num_garajes > 0, 1, 0)
df1 %>%
group_by(tiene_garaje) %>%
summarise(target = mean(TARGET)) %>%
ggplot(aes(x = tiene_garaje, y = target)) +
geom_point()
df1 %>%
group_by(tiene_garaje) %>%
ggplot(aes(x = tiene_garaje, y = TARGET)) +
geom_point()
df1 %>%
group_by(tiene_garaje) %>%
summarise(target = median(TARGET)) %>%
ggplot(aes(x = tiene_garaje, y = target)) +
geom_point()
summary(df1$tiene_garaje)
boxplot(df1$HY_precio) #muy asimétrica...
hist(df1$HY_precio)
hist(log1p(df1$HY_precio)) #esto está bastante mejor... mucho mejor sacando el logaritmo.
df1 %>%
ggplot(aes(x = log1p(HY_precio), y = log1p(TARGET))) +
geom_point() +
geom_smooth(method = "loess", se = T)
df1 %>%
ggplot(aes(x = log1p(HY_precio), y = log1p(HY_precio_anterior))) +
geom_point()
hist(log1p(df1$HY_precio_anterior))
df1 %>%
group_by(HY_tipo, HY_provincia) %>%
summarise(area = median(IDEA_area, na.rm=T), num = n()) %>%
ggplot(aes(x = HY_provincia, y = area, color = HY_tipo, size = num)) +
geom_point()
summary(df1$IDEA_area)
df1 %>%
ggplot(aes(x = log1p(IDEA_area), y = TARGET)) +
geom_point()
sum(is.na(df1$IDEA_area))
area_por_provincia <- data.frame(df1 %>%
group_by(HY_tipo, HY_provincia) %>%
summarise(area = mean(IDEA_area, na.rm = T)))
fill_area_nas <- function(df = df1, medias = area_por_provincia) {
for(i in 1:nrow(df)) {
if(is.na(df[i, "IDEA_area"])) {
media <- medias[which(medias$HY_provincia == df$HY_provincia[i] & medias$HY_tipo == df$HY_tipo[i]), "area"]
df[i, "IDEA_area"] <- media
} else {
next
}
}
return(df)
}
df2 <- fill_area_nas()
sum(is.na(df2$IDEA_area))
hist(log1p(df1$IDEA_area))
hist(log1p(df2$IDEA_area))
df1 %>%
ggplot(aes(x = IDEA_poblacion, y = TARGET)) +
geom_point() +
geom_smooth(method = "lm", se = T)
df1 %>%
ggplot(aes(x = log1p(IDEA_poblacion), y = TARGET)) +
geom_point() +
geom_smooth(method = "lm", se = T)
df1 %>%
ggplot(aes(x = log1p(IDEA_poblacion), y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = T)
#Densidad #####
df1 %>%
ggplot(aes(x = IDEA_densidad^2, y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = F)
df1 %>%
ggplot(aes(x = sqrt(IDEA_poblacion), y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = T)
df1 %>%
ggplot(aes(x = IDEA_poblacion^2, y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = T)
df1 %>%
ggplot(aes(x = IDEA_poblacion^2, y = log1p(TARGET))) +
geom_point() +
geom_smooth(method = "loess", se = T)
boxplot(df1$IDEA_pc_1960)
hist(df1$IDEA_pc_1960)
hist(log1p(df1$IDEA_pc_1960)) #lo normaliza un poco...
df1 %>%
ggplot(aes(x = IDEA_pc_1960, y = TARGET)) +
geom_point()
df1 %>%
ggplot(aes(x = log1p(IDEA_pc_1960), y = TARGET)) +
geom_point()
names(df1)[1:25]
df1 %>%
ggplot(aes(x = IDEA_pc_1960_69, y = TARGET)) +
geom_point()
df1 %>%
ggplot(aes(x = IDEA_pc_1960_69, y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = T)
df1 %>%
ggplot(aes(x = IDEA_pc_1970_79, y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = F)
df1 %>%
ggplot(aes(x = IDEA_pc_1980_89, y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = F)
df1 %>%
ggplot(aes(x = IDEA_pc_1960_69, y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = T)
df1 %>%
ggplot(aes(x = IDEA_pc_1960_69, y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = T)
df1 %>%
ggplot(aes(x = IDEA_pc_1970_79, y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = F)
df1 %>%
ggplot(aes(x = IDEA_pc_1980_89, y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = F)
df1 %>%
ggplot(aes(x = IDEA_pc_1990_99, y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = F)
df1 %>%
ggplot(aes(x = IDEA_pc_2000_10, y = TARGET)) +
geom_point() +
geom_smooth(method = "loess", se = F)
casas_nuevas <- c()
for(i in 1:nrow(df1)) {
if(df1$IDEA_pc_1960[i] <= 0.10 & df1$IDEA_pc_1960_69[i] <= 0.20
& df1$IDEA_pc_1970_79[i] <= 0.20 & df1$IDEA_pc_1980_89[i] <= 0.25
& df1$IDEA_pc_1990_99[i] <= 0.30 & df1$IDEA_pc_2000_10[i] <= 0.75) {
casas_nuevas <- c(casas_nuevas, 1)
} else {
casas_nuevas <- c(casas_nuevas, 0)
}
}
casas_nuevas <- c()
for(i in 1:nrow(df1)) {
if(is.na(df1$IDEA_pc_1960[i])){
casas_nuevas <- c(casas_nuevas, 1)
} else {
if(df1$IDEA_pc_1960[i] <= 0.10 & df1$IDEA_pc_1960_69[i] <= 0.20
& df1$IDEA_pc_1970_79[i] <= 0.20 & df1$IDEA_pc_1980_89[i] <= 0.25
& df1$IDEA_pc_1990_99[i] <= 0.30 & df1$IDEA_pc_2000_10[i] <= 0.75) {
casas_nuevas <- c(casas_nuevas, 1)
} else {
casas_nuevas <- c(casas_nuevas, 0)
}
}
}
df1$nueva <- casas_nuevas
df1 %>%
group_by(nueva) %>%
ggplot(aes(x = nueva, y = TARGET)) +
geom_point()
casas_nuevas2 <- c()
for(i in 1:nrow(df1)) {
if(is.na(df1$IDEA_pc_1960[i])){
casas_nuevas2 <- c(casas_nuevas2, 0)
} else {
if(df1$IDEA_pc_1960[i] <= 0.10 & df1$IDEA_pc_1960_69[i] <= 0.20
& df1$IDEA_pc_1970_79[i] <= 0.20 & df1$IDEA_pc_1980_89[i] <= 0.25
& df1$IDEA_pc_1990_99[i] <= 0.30 & df1$IDEA_pc_2000_10[i] <= 0.75) {
casas_nuevas2 <- c(casas_nuevas2, 1)
} else {
casas_nuevas2 <- c(casas_nuevas2, 0)
}
}
}
df1$nuevas2 <- casas_nuevas2
df1 %>%
group_by(nuevas2) %>%
ggplot(aes(x = nuevas2, y = TARGET)) +
geom_point() + geom_jitter()
df1$IDEA_pc_isna <- ifelse(is.na(df1$IDEA_pc_1960), 1, 0)
df1 %>%
group_by(IDEA_pc_isna) %>%
ggplot(aes(x = IDEA_pc_isna, y = TARGET)) +
geom_point()
casas_nuevas2 <- c()
for(i in 1:nrow(df1)) {
if(is.na(df1$IDEA_pc_1960[i])){
casas_nuevas2 <- c(casas_nuevas2, NA)
} else {
if(df1$IDEA_pc_1960[i] <= 0.10 & df1$IDEA_pc_1960_69[i] <= 0.20
& df1$IDEA_pc_1970_79[i] <= 0.20 & df1$IDEA_pc_1980_89[i] <= 0.25
& df1$IDEA_pc_1990_99[i] <= 0.30 & df1$IDEA_pc_2000_10[i] <= 0.75) {
casas_nuevas2 <- c(casas_nuevas2, 1)
} else {
casas_nuevas2 <- c(casas_nuevas2, 0)
}
}
}
df1$nuevas2 <- casas_nuevas2
df1 %>%
group_by(nuevas2) %>%
ggplot(aes(x = nuevas2, y = TARGET)) +
geom_point() + geom_jitter()
df1 %>%
group_by(nueva) %>%
summarise(target = mean(TARGET))
df1 %>%
group_by(nueva2) %>%
summarise(target = mean(TARGET))
df1 %>%
group_by(nuevas2) %>%
summarise(target = mean(TARGET))
casas_nuevas2 <- c()
for(i in 1:nrow(df1)) {
if(is.na(df1$IDEA_pc_1960[i])){
casas_nuevas2 <- c(casas_nuevas2, 0)
} else {
if(df1$IDEA_pc_1960[i] <= 0.10 & df1$IDEA_pc_1960_69[i] <= 0.20
& df1$IDEA_pc_1970_79[i] <= 0.20 & df1$IDEA_pc_1980_89[i] <= 0.25
& df1$IDEA_pc_1990_99[i] <= 0.30 & df1$IDEA_pc_2000_10[i] <= 0.75) {
casas_nuevas2 <- c(casas_nuevas2, 1)
} else {
casas_nuevas2 <- c(casas_nuevas2, 0)
}
}
}
df1$nuevas2 <- casas_nuevas2
df1 %>%
group_by(nuevas2) %>%
summarise(target = mean(TARGET))
df1 %>%
group_by(IDEA_pc_isna) %>%
summarise(target = mean(TARGET))
summary(df1$HY_antiguedad)
df1 %>%
ggplot(aes(x = HY_antiguedad, y = TARGET)) +
geom_point()
df1 %>%
ggplot(aes(x = log(HY_antiguedad), y = TARGET)) +
geom_point()
df1 %>%
ggplot(aes(x = log(HY_antiguedad), y = log1p(TARGET))) +
geom_point()
df1 %>%
ggplot(aes(x = HY_antiguedad, y = log1p(TARGET))) +
geom_point()
df1 %>%
ggplot(aes(x = HY_antiguedad, y = TARGET)) +
geom_point()
df1$antiguedad_conocida <- ifelse(!is.na(df1$HY_antiguedad), 1, 0)
df1 %>%
group_by(antiguedad_conocida) %>%
ggplot(aes(x = antiguedad_conocida, y = TARGET)) +
geom_point()
df1 %>%
group_by(antiguedad_conocida) %>%
summarise(target = mean(TARGET))
df1 %>%
group_by(antiguedad_conocida, HY_tipo) %>%
ggplot(aes(x = antiguedad_conocida, y = TARGET, color = HY_tipo)) +
geom_point()
df1 %>%
group_by(antiguedad_conocida, HY_tipo) %>%
ggplot(aes(x = antiguedad_conocida, y = TARGET, color = HY_tipo)) +
geom_point() + geom_jitter()
